#!/bin/bash

set -euf -o pipefail

SECRETS_DIR="$1"

DIR="$(cd $(dirname "$0")/.. && pwd)"

ID="$DIR/.my-secret-identity"
TEAM_FILE="$DIR/team.identities"

find "$SECRETS_DIR" -type f -print | while read -r file; do
    age --decrypt --identity $ID "$file" | "$DIR"/cmd/upsert-team-secret "$file"
done

echo "Done!"
